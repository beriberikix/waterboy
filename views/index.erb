<html>
  <head>
    <title>Project Waterboy</title>


    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" type="text/css" href="css/furatto.css">
    <link rel="stylesheet" type="text/css" href="css/normalize.css">

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="js/furatto.min.js"></script>
  </head>

  <body>

    <script>
      var socket = new WebSocket('ws://' + window.location.hostname + ':3002');
      socket.onmessage = function(msg) {
        console.log(msg);
        parseMessageData(msg.data);
      };

      function parseMessageData(data) {
        var scorePattern = /b([0-9]+)-r([0-9]+)/;
        if (scorePattern.test(data)) {
          // Score update
          var res = scorePattern.exec(data);
          $("#b-score").text(res[1]);
          $("#r-score").text(res[2]);
        } else if (data.indexOf("uid") >= 0) {
          // Player checking in
          var obj = JSON.parse(data);
          var nameElement;
          var imgElement;
          if (obj.team == "BLUE") {
            if (obj.position == "1") {
              nameElement = $("#bp1 > span");
              imgElement = $("#bp1 > img");
            } else if (obj.position == "2") {
              nameElement = $("#bp2 > span");
              imgElement = $("#bp2 > img");
            }
          } else if (obj.team == "RED") {
            if (obj.position == "1") {
              nameElement = $("#rp1 > span");
              imgElement = $("#rp1 > img");
            } else if (obj.position == "2") {
              nameElement = $("#rp2 > span");
              imgElement = $("#rp2 > img");
            }
          }

          nameElement.text(obj.name);
          imgElement.attr('src', obj.image_url);
        }
      }

      $(document).ready(function() {
        $("a.async").click(function(e) {
          e.preventDefault();
          $.get($(this).attr("href"));
        });
      });
    </script>
    <div class="jPanelMenu-panel" style="position: relative; left: 0px;">

      <!-- Start Navbar -->
      <div class="navbar inverse-navbar navbar-fixed-top navbar-alpha">
        <div class="navbar-inner">
          <div class="container">
            <a href="#menu" class="menu-trigger meteocon" data-meteocon="M"></a>
            <div class="nav-collapse collapse">
              <nav id="menu">
                <ul class="nav">
                  <li>
                    <a class="brand" href="/">Waterboy</a>
                  </li>
                  <li>
                    <a href="#">About</a>
                  </li>
                </ul>
              </nav>
            </div>
          </div>
        </div>
      </div>
      <!-- End Navbar -->

      <!-- Begin Main Container -->
      <div class="main-container">

        <!-- Begin Title -->
        <div class="row-fluid">
          <div class="span12">
            <div class="furatto-block">
              <div class="furatto-large-header">
                <div class="furatto-large-container">
                  <h1 class="large-header">
                    Project Waterboy
                  </h1>
                  <p class="motto">
                    Scoreboard
                  </p>
                  <hr/>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- End Title -->

        <!-- Begin Main Content Block -->
        <div class="container-center">
          <div class="row-fluid">
            <div class="span12">

              <div class="row-fluid">
                <div id="bluescore" class="score-box span6">
                  <span class="score" id="b-score">
                    <%= @match.goals_by("blue").count %>
                  </span>
                </div>

                <div id="redscore" class="score-box span6">
                  <span class="score" id="r-score">
                    <%= @match.goals_by("red").count %>
                  </span>
                </div>
              </div>

              <div class="row-fluid">
                <!-- BLUE TEAM -->
                <div class="userpic span3" id="bp1">
                  <img src="/img/blankuser.png"></img>
                  <span class="username">
                    ???
                  </span>
                </div>

                <div class="userpic span3" id="bp2" align="right">
                  <span class="username">
                    ???
                  </span>
                  <img src="/img/blankuser.png"></img>
                </div>

                <!-- RED TEAM -->
                <div class="userpic span3" id="rp1">
                  <img src="/img/blankuser.png"></img>
                  <span class="username">
                    ???
                  </span>
                </div>

                <div class="userpic span3" id="rp2" align="right">
                  <span class="username">
                    ???
                  </span>
                  <img src="/img/blankuser.png"></img>
                </div>
              </div>


              <h2>Options</h2>

              <a href='/match/new' class="async">
                <button class="btn">
                  New Match
                </button>
              </a>
              <a href='/match/delete' class="async">
                <button class="btn">
                  Delete Match
                </button>
              </a>

              <a href="/blue/up" class="async">
                <button class="btn btn-primary">
                  Blue &#x25B2;
                </button>
              </a>
              <a href="/blue/down" class="async">
                <button class="btn btn-primary">
                  Blue &#x25BC;
                </button>
              </a>
              <a  href="/red/up" class="async">
                <button class="btn btn-danger">
                  Red &#x25B2;
                </button>
              </a>
              <a href="/red/down" class="async">
                <button class="btn btn-danger">
                  Red &#x25BC;
                </button>
              </a>


              <h2>History</h2>
              <table class="table">
                <tr>
                  <th>Blue</th>
                  <th>Red</th>
                  <th>Start</th>
                </tr>
                <% @matches.each do |match| %>
                  <tr>
                    <td><%= match.goals_by("blue").count %></td>
                    <td><%= match.goals_by("red").count %></td>
                    <td><%= match.created_at %></td>
                  </tr>
                <% end %>
              </table>

            </div>
          </div>
        </div>
        <!-- End Main Content Block --.

      </div>
      <!-- End Main Container -->
    </div>

  </body>
</html>
